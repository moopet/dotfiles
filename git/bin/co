#!/bin/bash

# co: "Check Out".
# Checkout an existing branch based on a partial match.
#
# If FZF is installed, this script will use it.

if ! git status >/dev/null; then
  printf "Not a git repository.\n"
  exit 1
fi

if [ "$#" = "0" ]; then
  if command -v fzf >/dev/null; then
    branch="$(git branch -a | fzf | grep -oE '[^ ]+$')"

    if [ -n "$branch" ]; then
      git checkout "$branch"
    fi
  else
    git branch -a
  fi
else
  matches=$(git branch | grep -i "$1")
  count=$(git branch | grep -ci "$1")

  if [ "$count" = "1" ]; then
    shift
    git checkout $matches $*
  elif [ "$count" = "0" ]; then
    printf "No match for '%s'" "$1"
  else
    echo "Multiple matches:\n"

    for match in $matches; do
      printf "%s\n" "$match"
    done
  fi
fi
